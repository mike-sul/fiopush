# OSTree Hub

PoC of a service aimed for storing of OSTree repos generated by Foundries CI (LmP and container OSTree repos)
and distributing OSTree objects/files to a GCS bucket.

## Design
[Initial considerations](https://docs.google.com/document/d/19eSLBfRrZFnOHEquc5Sc4YTYWZB9KdGEGCDu5lbi0og/edit)

[Current PoC design](https://docs.google.com/document/d/1UJIxvgFXm3M0bWN8QlLxjh0dZfkncilKSBYaqcibyNs/edit)

## Build

```
make
```
or container
```
make container
```

## Run

### Server (ostreehub)
```
export GOOGLE_APPLICATION_CREDENTIALS=<path to the key.json file>
./bin/ostreehub 
```
or in container
```
export GOOGLE_APPLICATION_CREDENTIALS=<path to the key.json file>
make run
```


### Client (fiopush)
```
./bin/fiopush -server http://localhost:9101 -factory <factory-name> -repo <path to an ostree repo>
```
or
```
curl -s -X PUT http://localhost:9101/v1/repos/lmp?factory=<factory-name> --upload-file <path to an ostree repo TAR file>
```
or push to the staging
```
./bin/fiopush -creds <credentials.zip> -repo <path to an ostree repo>
```
